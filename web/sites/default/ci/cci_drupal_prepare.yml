---
platform: linux

image: "docker:///comicrelief/campaign-docker-cci#0.0.19"

inputs:
- name: campaign

outputs:
- name: campaign-prepared

params:
  APPLICATION_ENV: 'REPLACE'
  BASE_URL: 'http://REPLACE.campaign.comicrelief.com'
  CF_SPACE: REPLACE
  DB_QUERYSTRING: "mysql://REPLACE:REPLACE@REPLACE/REPLACE"
  DRUPAL_HASH_SALT: REPLACE
  VCAP_SERVICES: '{REPLACE}'

run:
  path: sh
  args:
   - -c
   - |
     sed -i "s/<<CF_SPACE>>/$APPLICATION_ENV/" campaign/sites/default/cf/manifest.yml
     ./campaign/sites/default/cf/drupal_prepare.sh
     cp -rT campaign campaign-prepared
